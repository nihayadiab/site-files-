----*********   project 1     ****************
----*********nihaya_diab_hamed  25/08/2025****************

---*****הפרוייקט מדמה את העבודה בפועל על נתוני שירות המדינה- כלל המועמדים שניגשים למכרזים בשירות המדינה, עוברין אבחון תעסוקתי
---*****לאחר מכן עוברים וועדת בוחנים השלב האחרון לבחירה במכרז
---***** העובדים הנבחרים יקושרו למשרה אליה נבחרים הכוללת את פירוט התפקיד ועוד
---***** הנתונים מתקבלים ממגוון מערכות מקוונות שנתוניהם בשפה העברית


----*********create database****************

create database db_civilservant101
go
use db_civilservant101
go
----*********CREATE TABLES****************

----*********יצירת טבלת משרות****************
----**** טבלת האב הינה טבלת המשרות בשירות המדינה - מספר המשרה מפתח שיקושר לטבלאות העובדים והמכרזים
create table positions(
    Positionid int not null  primary key,
    Positiontext nvarchar(100) not null,            -- שם המשרה
    Midrag nvarchar(20) not null,                       -- מדרג
    Derug nvarchar(20) not null,                        -- דירוג
    DegreeLg  nvarchar(20) not null,              -- דרגה עליונה
    DegreeLw  nvarchar(20) not null,               -- דרגה תחתונה
    MinistryId int not null,                       -- משרד ממשלתי
    MinistryText nvarchar(30) not null,              
    SystemName nvarchar(30) not null                     -- מערכת 
)

INSERT positions VALUES
('8000', N' מנכ"לית המשרד',  N'מח"ר', N'בכיר', N'42', N'44', N'300', N'משרד ממשלתי ', N'מערכת ממשלה'),
('8001', N'מנהל/ת אגף בכיר',N'מח"ר', N'בכיר', N'41', N'43', N'300', N'משרד ממשלתי', N'מערכת ממשלה'),
('8002', N'מנהל/ת ענף',N'מינהלי', N'מסד', N'16', N'18', N'300', N'משרד ממשלתי', N'מערכת ממשלה'),
('8003', N'רכז/ת פרויקטים',N'מח"ר', N'מירב', N'39', N'41', N'300', N'משרד ממשלתי', N'מערכת ממשלה'),
('8004', N'מנתח/ת מערכות',N'אישי', N'תיכון', N'א', N'ג', N'300', N'משרד ממשלתי', N'מערכת ממשלה'),
('8005', N'חשב/ת שכר',N'מח"ר', N'תיכון', N'41', N'43', N'300', N'משרד ממשלתי', N'מערכת ממשלה'),
('8006', N'רכז תחום',N'מח"ר', N'מירב', N'38', N'40', N'300', N'משרד ממשלתי', N'מערכת ממשלה'),
('8007', N'יועמ"ש',N'משפטנים', N'בכיר', N'19', N'16', N'300', N'משרד ממשלתי', N'מערכת ממשלה'),
('8008', N'רכז/ת משאבי אנוש', N'מסד', N'מש"א',  N'13', N'09', N'300', N'משרד ממשלתי', N'מערכת ממשלה'),
('8009', N'מנהל תחום ', N'מח"ר', N'תיכון', N'17', N'14', N'300', N'משרד ממשלתי', N'מערכת ממשלה'),
('8010', N'מנהל/ת בית חולים ', N'רופאים', N'בכיר', N'4', N'6', N'301', N'בית חולים ממשלתי', N'מערכת הבריאות'),
('8011', N'מנהל/ת אגף מעבדות ', N'רופאים', N'תיכון', N'3', N'5', N'301', N'בית חולים ממשלתי', N'מערכת הבריאות'),
('8012', N'אח/ות ראשית ', N'אחיות', N'תיכון', N'17', N'14', N'301', N'בית חולים ממשלתי', N'מערכת הבריאות'),
('8013', N'אח/ות ', N'מח"ר', N'תיכון', N'17', N'14', N'301', N'בית חולים ממשלתי', N'מערכת הבריאות'),
('8014', N'אח/ות ', N'מח"ר', N'תיכון', N'17', N'14', N'301', N'בית חולים ממשלתי', N'מערכת הבריאות'),
('8015', N'רכז/ת משאבי אנוש ', N'מח"ר', N'מסד', N'16', N'18', N'301', N'בית חולים ממשלתי', N'מערכת הבריאות')


----*********יצירת טבלת מכרזים****************
----****טבלת המכרזים המקושרת במפתח זר לטבלת המשרות וכטבלת אב לטבלת מיון מועמדים   
create table Tenders (
    Tenderid int primary key identity (1999,1),
    ReleaseDate date not null,
    TenderType nvarchar(100),
    Positionid int  not null references positions (positionid),
    Candidates int default 0,
    TendarStatus nvarchar(100),
    TendarStatusDate date default null, 
    Winnerid int null,
    CommitteeMeetingDate date default null 
)

INSERT Tenders (ReleaseDate, TenderType, Positionid, Candidates, TendarStatus, TendarStatusDate, Winnerid, CommitteeMeetingDate) VALUES 
('1997-03-15',N'פנימי ','8000', '9',N'לא נבחר מועמד ', '1997-12-01', NULL,'1997-12-01'),
('1999-03-15',N'פומבי ','8000', '7',N'נבחר מועמד ', '1999-12-01', '1','2001-12-01'),
('2004-06-15',N'פומבי ','8001', '15',N'נבחר מועמד ', '2005-05-01', '2','2005-05-01'),
('2006-04-15',N'פומבי ','8002', '36',N'נבחר מועמד ', '2007-01-20', '3','2007-03-20'),
('2004-06-15',N'פומבי ','8003', '48',N'נבחר מועמד ', '2008-05-01', '4','2008-06-01'),
('2006-04-15',N'פומבי ','8004', '26',N'נבחר מועמד ', '2014-12-03', '5','2015-01-06'),
('2006-04-15',N'פומבי ','8005', '3',N'נבחר מועמד ', '2016-02-20', '6','2016-04-11'),
('2006-04-15',N'פומבי ','8006', '17',N'נבחר מועמד ', '2012-12-20', '7','2013-01-02'),
('2006-04-15',N'פומבי ','8007', '102',N'נבחר מועמד ', '2016-08-15', '8','2016-12-20'),
('2006-04-15',N'פומבי ','8008', '55',N'נבחר מועמד ', '2011-09-05', '9','2012-01-01'),
('2006-04-15',N'פומבי ','8009', '28',N'נבחר מועמד ', '2018-04-20', '11','2019-01-20'),
('2006-04-15',N'פומבי ','8010', '36',N'נבחר מועמד ', '2017-11-02', '12','2018-02-20'),
('2006-04-15',N'פומבי ','8011', '12',N'נבחר מועמד ', '2018-04-03', '13','2018-08-01'),
('2006-04-15',N'פומבי ','8012', '25',N'נבחר מועמד ', '2018-01-20', '14','2018-04-05'),
('2025-04-16',N'פומבי ','8013', NULL,N'בתהליך ', '2025-04-16', NULL,NULL),
('2025-04-18',N'פומבי ','8014', NULL,N'בתהליך ', '2025-04-18', NULL,NULL),
('2025-04-19',N'פומבי ','8015', NULL,N'בתהליך ','2025-04-19', NULL,NULL)


--**יצירת טבלת העובדים***--
--** טבלת עובדי המדינה בשירות המדינה המקטשרת לטבלת המשרות. והמקושרת לעצמה המנהל כעובד
create table employees (
    Employeeid int  primary key not null,
    Firstname nvarchar(20) not null,
    Lasttname nvarchar(20) not null,
    Birthdate date not null,
    Phone nvarchar(30) unique,
    Email nvarchar(50) null,
    Gender nvarchar(10) not null check (gender IN (N'זכר', N'נקבה')),
    MinistryHiredate date not null,
    CivilServicehiredate date not null,
    MinistryId int not null,                      
    Positionid int  not null references positions (positionid),
    Managerid int null references employees (employeeid)
)

INSERT employees VALUES 
(1, N'דוד', N'כהן', '1975-03-15', '050-1234567', 'david@example.com', N'זכר','2000-01-01', '1998-05-01','300', '8000', NULL),
(2, N'שרה', N'לוי', '1980-07-22', '052-2345678', 'sara@example.com', N'נקבה','2005-06-15', '2003-09-10','300', '8001', 1),
(3, N'אבי', N'מזרחי','1978-12-10', '052-3456789', 'avi@example.com', N'זכר','2007-04-20', '2004-01-15','300', '8002', 1),
(4, N'חנה', N'משה', '1982-09-05', '052-4567890', 'hanna@example.com', N'נקבה','2008-08-12', '2006-03-18','300', '8003', 1),
(5, N'יוסי', N'ישראל', '1990-11-05', '053-5678901', 'yossi@example.com', N'זכר','2015-03-01', '2012-07-20','300', '8004', 2),
(6, N'דנה', N'מנשה', '1992-01-15', '054-6789012', 'dana@example.com', N'נקבה','2016-07-11', '2016-07-11','300', '8005', 2),
(7, N'רון', N'ברק', '1988-06-25', '054-7890123', 'ron@example.com', N'זכר','2013-02-10', '2010-06-30','300','8006', 3),
(8, N'מיטל', N'אביטן', '1991-04-18', '054-8901234', 'meital@example.com', N'נקבה','2017-01-01', '2015-08-15','300', '8007', 3),
(9, N'אורן', N'שלמה', '1989-02-20', '055-9012345', 'oren@example.com', N'זכר','2012-05-15', '2011-01-25','300', '8008', 4),
(10,N'ליאת', N'ברוך', '1993-10-08', '055-0123456', 'liat@example.com', N'נקבה','2018-09-01', '2016-11-10','300', '8009', 4),
(11,N'ליטל', N'משה', '1975-03-16', '055-9876543', 'liat@example.com', N'נקבה','2018-09-01', '2016-11-10','301', '8009', 4),
(12,N'שרית', N'אליהו', '1980-07-23', '055-8765432', 'liat@example.com', N'נקבה','2018-09-01', '2016-11-10','301', '8010', null),
(13,N'יוני', N'כהן', '1990-10-08', '055-7654321', 'liat@example.com', N'נקבה','2018-09-01', '2016-11-10','301', '8011', 12),
(14,N'דנה', N'דוד', '2000-10-09', '055-6543210', 'liat@example.com', N'נקבה','2018-09-01', '2016-11-10','301', '8012', 13),
(15,N'מיטל', N'כהן', '1986-10-10', '055-5432109', 'liat@example.com', N'נקבה','2018-09-01', '2016-11-10','301', '8013', 13)


----*********יצירת טבלת הערכת עובדים****************
----****** הערכת עובדים מצביעה על המצטיינים ומקושרת לטבלת העובדים הכללית ולטבלת המשרות בשירות המדינה
create table evaluation_emp (
    employeeid int references employees (employeeid),
    EvaluationDate date not null,
    Positionid int not null references positions (positionid),
    IndividualEvaluationScore1 int,
    IndividualEvaluationScore2 int,
    ProfessionalEvaluationScore1 int,
    ProfessionalEvaluationScore2 int,
    ProfessionalEvaluationScore3 int,
    Managerid nvarchar(30),
    Excellent bit not null
)

INSERT evaluation_emp VALUES 
(1, '2024-02-01', '8000', null,null,null,null,null,null,0),
(2,  '2024-03-01', '8001', '5','6','4','4','5', 1,0),
(3,  '2024-03-02', '8002', '6','6','6','6','6', 1,1),
(4, '2024-02-01', '8003', '5','6','4','4','5', 1,0),
(5, '2024-02-01', '8004', '5','6','4','4','5', 2,0),
(6,  '2024-04-01', '8005', '3','6','3','4','5', 2,0),
(7,  '2024-02-01', '8006', '5','6','4','4','5', 3,0),
(8,  '2024-01-01', '8007', '4','6','4','3','5', 3,0),
(9,  '2024-03-01', '8008', '5','6','4','4','5', 4,0),
(10, '2024-02-01', '8009', '5','6','4','6','6', 4,0),
(11, '2024-01-03', '8009', '6','6','5','5','6', 4,0),
(12, '2024-02-04', '8010', null,null,null,null,null, null,0),
(13, '2024-03-05', '8011', '5','6','4','5','3', 12,0),
(14, '2024-03-12', '8012', '4','6','4','6','5', 13,0),
(15, '2024-03-13', '8013', '5','6','6','6','6',13,1)

----*********יצירת טבלת מיון עובדים****************

create table employeeselection (
    employeeid int references employees(employeeid),
    CognitiveScore1 int,
    CognitiveScore2 int,
    CognitiveScore3 int,
    PersonalityScore1 int,
    PersonalityScore2 int,
    PersonalityScore3 int
)

INSERT employeeselection VALUES 
(2, '6','4','5','6','7','8'),
(4, '7','8','6','6','6','9'),
(5, '6','3','4','4','5','9'),
(6, '6','4','6','8','7','6'),
(13, '6','6','5','6','9','6')






